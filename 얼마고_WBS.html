<YPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프로젝트 WBS 간트 차트 시각화</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc; /* bg-gray-50 */
            color: #1e293b; /* text-slate-800 */
        }
        /* 커스텀 스크롤바 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        /* 그리드 라인 스타일 */
        .gantt-grid-bg {
            background-size: calc(100% / 8) 100%; /* 8일 기준 */
            background-image: linear-gradient(to right, #e2e8f0 1px, transparent 1px);
        }
        .task-bar-popup {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease;
            position: absolute;
            bottom: 105%;
            left: 50%;
            transform: translateX(-50%) translateY(5px);
            min-width: 250px;
            z-index: 20;
        }
        .task-bar:hover .task-bar-popup {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-10">

    <div class="max-w-screen-xl mx-auto">
        <header class="mb-10 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-800">전통시장 활성화 서비스 프로젝트 WBS</h1>
            <p class="text-slate-500 mt-2">날짜 기반 타임라인으로 시각화한 프로젝트 작업 구조입니다.</p>
        </header>

        <!-- 간트 차트 컨테이너 -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-slate-200">
            <div id="gantt-chart-container" class="overflow-x-auto">
                <!-- WBS 데이터가 동적으로 채워질 영역 -->
                <div id="wbs-chart"></div>
            </div>
        </div>
    </div>

    <script>
        // --- 데이터 영역 ---
        const wbsData = [
            {
                phase: "1. 프로젝트 기획",
                tasks: [
                    { mid: "1.1 문제 정의", details: ["전통시장 문제 도출", "타겟 고객 페인포인트 분석"], output: "프로젝트 기획서", startDate: "2025-08-11", endDate: "2025-08-12" },
                    { mid: "1.2 목표 및 범위 설정", details: ["서비스 목적·기대효과 명확화", "기능 범위 정의"], output: "프로젝트 기획서", startDate: "2025-08-11", endDate: "2025-08-12" },
                    { mid: "1.3 일정 계획", details: ["Gantt 차트 작성", "주요 마일스톤 설정"], output: "프로젝트 일정표", startDate: "2025-08-11", endDate: "2025-08-12" }
                ]
            },
            {
                phase: "2. 기능 정의 및 시나리오",
                tasks: [
                    { mid: "2.1 핵심 기능 도출", details: ["GPS, 시세 조회, 리뷰, 다국어 등"], output: "프로젝트 기획서", startDate: "2025-08-11", endDate: "2025-08-13" },
                    { mid: "2.2 사용자 페르소나 시나리오", details: ["사용자 유형별 시나리오 작성"], output: "프로젝트 기획서", startDate: "2025-08-11", endDate: "2025-08-13" }
                ]
            },
            {
                phase: "3. 자료 조사 및 벤치마킹",
                tasks: [
                    { mid: "3.1 데이터 조사", details: ["농수산물 시세 데이터", "전통시장 시설 정보"], output: "데이터 수집 리포트", startDate: "2025-08-12", endDate: "2025-08-14" },
                    { mid: "3.2 경쟁 서비스 분석", details: ["유사 앱, 지도 서비스 분석"], output: "프로젝트 기획서", startDate: "2025-08-12", endDate: "2025-08-13" }
                ]
            },
            {
                phase: "4. 요구사항 및 WBS",
                tasks: [
                    { mid: "4.1 기능 요구사항", details: ["사용자·시스템·성능 요구사항 정리"], output: "요구사항 정의서", startDate: "2025-08-13", endDate: "2025-08-14" },
                    { mid: "4.2 비기능 요구사항", details: ["보안, 데이터 정확도, 응답 속도 등"], output: "요구사항 정의서", startDate: "2025-08-13", endDate: "2025-08-14" }
                ]
            },
            {
                phase: "5. UI/UX 설계",
                tasks: [
                    { mid: "5.1 화면 기획", details: ["주요 화면 설계"], output: "와이어프레임", startDate: "2025-08-13", endDate: "2025-08-14" },
                    { mid: "5.2 UX 플로우", details: ["서비스 흐름 제시"], output: "프로젝트 설계서", startDate: "2025-08-13", endDate: "2025-08-14" }
                ]
            },
            {
                phase: "6. 기술 설계",
                tasks: [
                    { mid: "6.1 데이터 처리 구조", details: ["데이터 결합 구조 설계"], output: "프로젝트 설계서", startDate: "2025-08-14", endDate: "2025-08-15" },
                    { mid: "6.2 API 설계", details: ["Open API, 지도 플랫폼, 번역 API"], output: "프로젝트 기획서", startDate: "2025-08-14", endDate: "2025-08-15" }
                ]
            },
            {
                phase: "7. 마케팅 및 홍보",
                tasks: [
                    { mid: "7.1 오프라인 홍보", details: ["배너 홍보"], output: "홍보물 디자인", startDate: "2025-08-15", endDate: "2025-08-18" },
                    { mid: "7.2 온라인 홍보", details: ["인플루언서 마케팅", "SNS 공유 기능"], output: "프로젝트 기획서", startDate: "2025-08-15", endDate: "2025-08-18" }
                ]
            },
            {
                phase: "8. 최종 피드백 및 발표",
                tasks: [
                    { mid: "8.1 중간 점검", details: ["중간 결과 공유, 피드백 수렴"], output: "기획서 반영", startDate: "2025-08-13", endDate: "2025-08-18" },
                    { mid: "8.2 최종 발표", details: ["서비스 개념 및 기획 발표"], output: "최종 발표 장표", startDate: "2025-08-17", endDate: "2025-08-18" }
                ]
            }
        ];

        // --- 렌더링 로직 ---
        const chartContainer = document.getElementById('wbs-chart');
        const projectStartDate = new Date("2025-08-11");
        const projectEndDate = new Date("2025-08-18");

        const dateDiffInDays = (a, b) => {
            const _MS_PER_DAY = 1000 * 60 * 60 * 24;
            const utc1 = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());
            const utc2 = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());
            return Math.floor((utc2 - utc1) / _MS_PER_DAY);
        };

        const totalDays = dateDiffInDays(projectStartDate, projectEndDate) + 1;
        
        const colors = [
            '#34d399', '#22d3ee', '#60a5fa', '#a78bfa',
            '#f472b6', '#fb923c', '#facc15', '#a3e635'
        ];

        let chartHTML = '';

        // 1. 타임라인 헤더 생성
        let dateHeaderHTML = '';
        for (let i = 0; i < totalDays; i++) {
            const currentDate = new Date(projectStartDate);
            currentDate.setDate(projectStartDate.getDate() + i);
            const day = ['일', '월', '화', '수', '목', '금', '토'][currentDate.getDay()];
            dateHeaderHTML += `<div class="text-center p-2 text-sm font-medium text-slate-500">
                <div class="text-xs">${day}</div>
                <div>${currentDate.getDate()}</div>
            </div>`;
        }
        
        chartHTML += `
            <div class="min-w-[1000px]">
                <!-- Header Row -->
                <div class="sticky top-0 bg-white/70 backdrop-blur-sm z-10 grid" style="grid-template-columns: minmax(200px, 25%) 1fr;">
                    <div class="p-2 font-bold text-slate-700 text-center border-r border-b border-slate-200 flex items-center justify-center">작업</div>
                    <div class="grid border-b border-slate-200" style="grid-template-columns: repeat(${totalDays}, 1fr);">
                        ${dateHeaderHTML}
                    </div>
                </div>

                <!-- Data Rows -->
        `;

        // 2. WBS 데이터 기반 행 생성
        wbsData.forEach((phase, phaseIndex) => {
            chartHTML += `
                <div class="grid" style="grid-template-columns: minmax(200px, 25%) 1fr;">
                    <div class="col-span-full bg-slate-100 font-bold p-2 text-slate-600 border-b border-t border-slate-200">
                        ${phase.phase}
                    </div>
                </div>
            `;
            
            phase.tasks.forEach(task => {
                const taskStartDate = new Date(task.startDate);
                const taskEndDate = new Date(task.endDate);
                const startDay = dateDiffInDays(projectStartDate, taskStartDate); // 0-indexed
                const duration = dateDiffInDays(taskStartDate, taskEndDate) + 1;
                const taskBarColor = colors[phaseIndex % colors.length];

                chartHTML += `
                    <div class="grid border-b border-slate-200" style="grid-template-columns: minmax(200px, 25%) 1fr;">
                        <!-- Task Name Column -->
                        <div class="p-3 text-sm border-r border-slate-200 truncate flex items-center min-h-[50px]">${task.mid}</div>
                        
                        <!-- Timeline Column which is a grid itself -->
                        <div class="relative grid gantt-grid-bg" style="grid-template-columns: repeat(${totalDays}, 1fr);">
                            <!-- Task Bar positioned on the timeline grid -->
                            <div class="task-bar relative p-1 h-full" style="grid-column: ${startDay + 1} / span ${duration};">
                                <div class="relative w-full h-full rounded-md flex items-center justify-start px-3 text-white font-semibold text-sm shadow-md" style="background-color: ${taskBarColor};">
                                    <span class="truncate">${task.mid}</span>
                                </div>
                                <!-- Hover Popup -->
                                <div class="task-bar-popup bg-slate-800 text-white p-3 rounded-lg shadow-xl w-max">
                                     <h4 class="font-bold text-base">${task.mid}</h4>
                                     <p class="text-xs text-slate-400 mb-2">${task.startDate} ~ ${task.endDate}</p>
                                     <ul class="list-disc list-inside text-sm text-slate-300 space-y-1">
                                         ${task.details.map(detail => `<li>${detail}</li>`).join('')}
                                     </ul>
                                     <div class="mt-2 text-right">
                                         <span class="inline-block bg-white/20 text-white text-xs font-semibold px-2 py-1 rounded-full">
                                            산출물: ${task.output}
                                         </span>
                                     </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
        });
        
        chartHTML += `</div>`;

        chartContainer.innerHTML = chartHTML;
    </script>
</body>
</html>
